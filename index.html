<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5 Ingredients ‚Äì Jamie Oliver Recipe Finder</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --cream: #F5EFE0;
    --warm-white: #FAF7F0;
    --olive: #5C6B2E;
    --olive-light: #8A9B4A;
    --burnt: #C4622D;
    --burnt-light: #E8845A;
    --charcoal: #2A2825;
    --mid: #6B6560;
    --border: #DDD5C0;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--charcoal);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grain overlay */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 999; opacity: 0.4;
  }

  header {
    padding: 3rem 2rem 2rem;
    text-align: center;
    border-bottom: 1px solid var(--border);
    position: relative;
  }

  .header-tag {
    font-size: 0.72rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--burnt);
    font-weight: 500;
    margin-bottom: 0.75rem;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.4rem, 7vw, 5rem);
    font-weight: 900;
    line-height: 1;
    color: var(--charcoal);
  }

  h1 em {
    font-style: italic;
    color: var(--burnt);
  }

  .subtitle {
    margin-top: 0.75rem;
    font-size: 0.95rem;
    color: var(--mid);
    max-width: 420px;
    margin-inline: auto;
  }

  /* Decorative olive branch */
  .deco {
    font-size: 1.8rem;
    margin-bottom: 0.5rem;
    display: block;
  }

  /* Main container */
  main {
    max-width: 760px;
    margin: 0 auto;
    padding: 2.5rem 1.5rem 5rem;
  }

  /* Filter section */
  .filters {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 20px rgba(44,40,37,0.06);
  }

  .filter-label {
    font-size: 0.72rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    color: var(--mid);
    font-weight: 500;
    margin-bottom: 0.8rem;
    display: block;
  }

  /* Mood chips */
  .chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .chip {
    cursor: pointer;
    border: 1.5px solid var(--border);
    background: transparent;
    padding: 0.5rem 1rem;
    border-radius: 999px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--charcoal);
    transition: all 0.18s ease;
    user-select: none;
  }

  .chip:hover { border-color: var(--burnt); color: var(--burnt); }
  .chip.active {
    background: var(--burnt);
    border-color: var(--burnt);
    color: white;
  }

  /* Time slider */
  .time-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
  }

  input[type=range] {
    flex: 1;
    -webkit-appearance: none;
    height: 4px;
    background: var(--border);
    border-radius: 99px;
    outline: none;
  }

  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px; height: 20px;
    border-radius: 50%;
    background: var(--burnt);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(196,98,45,0.4);
    transition: transform 0.15s;
  }

  input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  .time-val {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--burnt);
    min-width: 70px;
    text-align: right;
  }

  /* Free text */
  .free-input {
    width: 100%;
    border: 1.5px solid var(--border);
    background: transparent;
    border-radius: 10px;
    padding: 0.75rem 1rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    color: var(--charcoal);
    resize: none;
    outline: none;
    transition: border-color 0.2s;
    margin-top: 0.3rem;
  }

  .free-input:focus { border-color: var(--burnt); }
  .free-input::placeholder { color: #BEB5A5; }

  /* Button */
  .find-btn {
    width: 100%;
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--charcoal);
    color: var(--cream);
    border: none;
    border-radius: 10px;
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-style: italic;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s;
    letter-spacing: 0.02em;
  }

  .find-btn:hover { background: var(--burnt); transform: translateY(-1px); }
  .find-btn:active { transform: translateY(0); }
  .find-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* Results */
  #results {
    animation: fadeUp 0.5s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .results-header {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-style: italic;
    color: var(--olive);
    margin-bottom: 1.2rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border);
  }

  /* Recipe card */
  .recipe-card {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1.6rem;
    margin-bottom: 1.2rem;
    box-shadow: 0 2px 16px rgba(44,40,37,0.05);
    transition: box-shadow 0.2s, transform 0.2s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .recipe-card::before {
    content: '';
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 4px;
    background: var(--burnt);
    border-radius: 4px 0 0 4px;
  }

  .recipe-card:hover {
    box-shadow: 0 8px 32px rgba(44,40,37,0.12);
    transform: translateY(-2px);
  }

  .recipe-card.expanded::before { background: var(--olive); }

  .card-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .recipe-name {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 700;
    line-height: 1.3;
    flex: 1;
  }

  .recipe-meta {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
    flex-wrap: wrap;
    justify-content: flex-end;
  }

  .badge {
    font-size: 0.72rem;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.6rem;
    border-radius: 99px;
    font-weight: 500;
  }

  .badge-time {
    background: #E8F0D0;
    color: var(--olive);
    border: 1px solid #C8D89A;
  }

  .badge-type {
    background: #FBE9DF;
    color: var(--burnt);
    border: 1px solid #EEC4AB;
  }

  .card-teaser {
    margin-top: 0.6rem;
    font-size: 0.88rem;
    color: var(--mid);
    line-height: 1.5;
  }

  .card-details {
    display: none;
    margin-top: 1.2rem;
    padding-top: 1.2rem;
    border-top: 1px solid var(--border);
    animation: fadeUp 0.3s ease;
  }

  .recipe-card.expanded .card-details { display: block; }

  .detail-section-title {
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--mid);
    font-weight: 500;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
  }

  .detail-section-title:first-child { margin-top: 0; }

  .ingredients-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
    margin-bottom: 0.2rem;
  }

  .ingredient-pill {
    background: #F0EBE0;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.3rem 0.65rem;
    font-size: 0.83rem;
    color: var(--charcoal);
  }

  .steps-text {
    font-size: 0.9rem;
    line-height: 1.7;
    color: var(--charcoal);
    white-space: pre-line;
  }

  .tip-box {
    background: #F0EBE0;
    border-left: 3px solid var(--olive-light);
    border-radius: 0 8px 8px 0;
    padding: 0.7rem 1rem;
    margin-top: 0.8rem;
    font-size: 0.85rem;
    color: var(--mid);
    font-style: italic;
    line-height: 1.5;
  }

  /* Loading */
  .loading {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--mid);
  }

  .loading-anim {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-bottom: 1rem;
  }

  .loading-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--burnt);
    animation: bounce 1.2s ease-in-out infinite;
  }

  .loading-dot:nth-child(2) { animation-delay: 0.2s; background: var(--olive); }
  .loading-dot:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
  }

  .loading-text {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: 1.1rem;
  }

  .error-msg {
    background: #FBE9DF;
    border: 1px solid #EEC4AB;
    border-radius: 10px;
    padding: 1rem 1.2rem;
    color: var(--burnt);
    font-size: 0.9rem;
    text-align: center;
  }

  .expand-hint {
    font-size: 0.78rem;
    color: var(--mid);
    margin-top: 0.5rem;
    opacity: 0.8;
  }

  /* API Key section */
  .api-section {
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.4rem 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 20px rgba(44,40,37,0.06);
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .api-section .filter-label { margin-bottom: 0; white-space: nowrap; }

  .api-key-row {
    display: flex;
    flex: 1;
    gap: 0.6rem;
    min-width: 240px;
  }

  .api-input {
    flex: 1;
    border: 1.5px solid var(--border);
    background: transparent;
    border-radius: 8px;
    padding: 0.55rem 0.9rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--charcoal);
    outline: none;
    transition: border-color 0.2s;
    font-family: monospace;
    letter-spacing: 0.05em;
  }

  .api-input:focus { border-color: var(--burnt); }
  .api-input::placeholder { font-family: 'DM Sans', sans-serif; letter-spacing: 0; color: #BEB5A5; }

  .api-save-btn {
    padding: 0.55rem 1rem;
    background: var(--olive);
    color: white;
    border: none;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
    white-space: nowrap;
  }

  .api-save-btn:hover { background: var(--olive-light); }

  .api-status {
    font-size: 0.78rem;
    margin-top: 0.4rem;
    width: 100%;
  }

  .api-status.ok { color: var(--olive); }
  .api-status.err { color: var(--burnt); }

  @media (max-width: 480px) {
    .card-top { flex-direction: column; }
    .recipe-meta { justify-content: flex-start; }
  }
</style>
</head>
<body>

<header>
  <span class="deco">üåø</span>
  <div class="header-tag">Jamie Oliver</div>
  <h1><em>5 Ingredients</em><br>Recipe Finder</h1>
  <p class="subtitle">Tell me what you're craving and how long you've got. I'll find the perfect recipe.</p>
</header>

<main>
  <!-- API Key -->
  <div class="api-section">
    <span class="filter-label">üîë Google API Key</span>
    <div style="flex:1; min-width:240px;">
      <div class="api-key-row">
        <input class="api-input" type="password" id="apiKeyInput" placeholder="AIza‚Ä¶" autocomplete="off" />
        <button class="api-save-btn" onclick="saveKey()">Save</button>
      </div>
      <div class="api-status" id="apiStatus">Get a free key at <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--burnt)">aistudio.google.com</a> ‚Äî it stays in your browser only.</div>
    </div>
  </div>

  <div class="filters">
    <span class="filter-label">What are you feeling like?</span>
    <div class="chips" id="moodChips">
      <div class="chip" data-val="something light and fresh">ü•ó Light & Fresh</div>
      <div class="chip" data-val="hearty and comforting">üç≤ Hearty & Comforting</div>
      <div class="chip" data-val="pasta">üçù Pasta</div>
      <div class="chip" data-val="fish or seafood">üêü Fish</div>
      <div class="chip" data-val="chicken">üçó Chicken</div>
      <div class="chip" data-val="meat">ü•© Meat</div>
      <div class="chip" data-val="vegetarian">üå± Veggie</div>
      <div class="chip" data-val="something sweet or dessert">üçÆ Dessert</div>
      <div class="chip" data-val="quick weeknight dinner">‚ö° Weeknight</div>
      <div class="chip" data-val="brunch or eggs">üç≥ Brunch</div>
    </div>

    <span class="filter-label">Max prep + cook time</span>
    <div class="time-row">
      <input type="range" id="timeSlider" min="10" max="60" step="5" value="30">
      <span class="time-val" id="timeVal">30 min</span>
    </div>

    <span class="filter-label" style="margin-top:1.2rem;">Anything else? (optional)</span>
    <textarea class="free-input" id="freeText" rows="2" placeholder="e.g. no dairy, something impressive for guests, using up leftover veggies‚Ä¶"></textarea>

    <button class="find-btn" id="findBtn" onclick="findRecipes()">Find me something delicious ‚Üí</button>
  </div>

  <div id="results"></div>
</main>

<script>
  // API Key management
  let apiKey = sessionStorage.getItem('anthropic_key') || '';

  function saveKey() {
    const val = document.getElementById('apiKeyInput').value.trim();
    if (!val.startsWith('AIza')) {
      document.getElementById('apiStatus').textContent = '‚ö†Ô∏è That doesn\'t look right ‚Äî Gemini keys start with AIza';
      document.getElementById('apiStatus').className = 'api-status err';
      return;
    }
    apiKey = val;
    sessionStorage.setItem('anthropic_key', val);
    document.getElementById('apiKeyInput').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' + val.slice(-4);
    document.getElementById('apiStatus').textContent = '‚úì Key saved for this session';
    document.getElementById('apiStatus').className = 'api-status ok';
  }

  // Pre-fill if already saved
  if (apiKey) {
    document.getElementById('apiKeyInput').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' + apiKey.slice(-4);
    document.getElementById('apiStatus').textContent = '‚úì Key loaded from session';
    document.getElementById('apiStatus').className = 'api-status ok';
  }

  // Allow Enter key to save
  document.getElementById('apiKeyInput').addEventListener('focus', function() {
    if (apiKey) this.value = apiKey;
  });
  document.getElementById('apiKeyInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') saveKey();
  });
  // Time slider
  const slider = document.getElementById('timeSlider');
  const timeVal = document.getElementById('timeVal');
  slider.addEventListener('input', () => {
    timeVal.textContent = slider.value + ' min';
  });

  // Mood chips (multi-select)
  const chips = document.querySelectorAll('.chip');
  chips.forEach(c => c.addEventListener('click', () => c.classList.toggle('active')));

  // Find recipes
  async function findRecipes() {
    const btn = document.getElementById('findBtn');
    const resultsEl = document.getElementById('results');

    if (!apiKey) {
      resultsEl.innerHTML = `<div class="error-msg">Please enter your Anthropic API key above first.</div>`;
      document.getElementById('apiKeyInput').focus();
      return;
    }

    const selectedMoods = [...document.querySelectorAll('.chip.active')].map(c => c.dataset.val);
    const maxTime = slider.value;
    const freeText = document.getElementById('freeText').value.trim();

    const moodStr = selectedMoods.length ? selectedMoods.join(', ') : 'anything';

    btn.disabled = true;
    resultsEl.innerHTML = `
      <div class="loading">
        <div class="loading-anim">
          <div class="loading-dot"></div>
          <div class="loading-dot"></div>
          <div class="loading-dot"></div>
        </div>
        <div class="loading-text">Flicking through the book‚Ä¶</div>
      </div>`;

    const prompt = `You are a culinary assistant helping someone find recipes from Jamie Oliver's "5 Ingredients ‚Äì Quick & Easy Food" cookbook.

The user wants:
- Mood/craving: ${moodStr}
- Max time: ${maxTime} minutes
- Extra notes: ${freeText || 'none'}

Suggest 3‚Äì4 recipes from the book that fit. For each recipe, return structured data in this EXACT JSON format (return ONLY the JSON array, no markdown, no preamble):

[
  {
    "name": "Recipe Name",
    "time": "20 mins",
    "category": "Chicken",
    "teaser": "One sentence enticing description",
    "ingredients": ["ingredient 1", "ingredient 2", "ingredient 3", "ingredient 4", "ingredient 5"],
    "method": "Step-by-step instructions as a concise paragraph or short steps. Keep it practical and clear.",
    "tip": "Jamie's tip or a serving suggestion"
  }
]

Only include recipes that genuinely appear in the 5 Ingredients book. If fewer than 3 fit perfectly, include 2-3 that are closest. Be accurate about the ingredients (exactly 5 per recipe, as the book uses).`;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          generationConfig: { temperature: 0.7, maxOutputTokens: 1500 }
        })
      });

      const data = await response.json();
      if (data.error) throw new Error(data.error.message);
      const text = data.candidates[0].content.parts[0].text;
      const clean = text.replace(/```json|```/g, '').trim();
      const recipes = JSON.parse(clean);

      renderRecipes(recipes, moodStr, maxTime);
    } catch (err) {
      resultsEl.innerHTML = `<div class="error-msg">Couldn't fetch recipes: ${err.message || 'Please check your API key and try again.'}</div>`;
      console.error(err);
    } finally {
      btn.disabled = false;
    }
  }

  function renderRecipes(recipes, mood, time) {
    const el = document.getElementById('results');
    if (!recipes.length) {
      el.innerHTML = `<div class="error-msg">No matching recipes found. Try adjusting your filters!</div>`;
      return;
    }

    const cards = recipes.map((r, i) => `
      <div class="recipe-card" id="card-${i}" onclick="toggleCard(${i})">
        <div class="card-top">
          <div class="recipe-name">${r.name}</div>
          <div class="recipe-meta">
            <span class="badge badge-time">‚è± ${r.time}</span>
            <span class="badge badge-type">${r.category}</span>
          </div>
        </div>
        <div class="card-teaser">${r.teaser}</div>
        <div class="expand-hint">Tap to see ingredients & method ‚Üì</div>
        <div class="card-details">
          <div class="detail-section-title">5 Ingredients</div>
          <div class="ingredients-list">
            ${r.ingredients.map(ing => `<span class="ingredient-pill">üåø ${ing}</span>`).join('')}
          </div>
          <div class="detail-section-title" style="margin-top:1rem;">Method</div>
          <div class="steps-text">${r.method}</div>
          ${r.tip ? `<div class="tip-box">üí° ${r.tip}</div>` : ''}
        </div>
      </div>
    `).join('');

    el.innerHTML = `
      <div class="results-header">Here's what I found for you‚Ä¶</div>
      ${cards}
    `;
    el.style.animation = 'none';
    requestAnimationFrame(() => { el.style.animation = ''; });
  }

  function toggleCard(i) {
    const card = document.getElementById(`card-${i}`);
    card.classList.toggle('expanded');
    const hint = card.querySelector('.expand-hint');
    if (card.classList.contains('expanded')) {
      hint.textContent = 'Tap to collapse ‚Üë';
    } else {
      hint.textContent = 'Tap to see ingredients & method ‚Üì';
    }
  }
</script>
</body>
</html>
